@page "/loan"
@using FutureFinans.Models
@using MudBlazor


<MudPaper Class="pa-6 mx-auto mt-6" Style="max-width:600px;">
    <MudText Typo="Typo.h4" GutterBottom="true">💰 Ansök om lån</MudText>
    <EditForm Model="loanApp" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <!-- Namn -->
        <MudTextField @bind-Value="loanApp.ApplicantName" Label="👤 Namn" Variant="Variant.Outlined" Required="true" />

        <!-- Lånebelopp -->
        <MudSlider @bind-Value="loanApp.LoanAmount" Min="1000" Max="1000000" Step="1000" Label="💵 Lånebelopp" TickInterval="100000" />

        <!-- Lånetid -->
        <MudSlider @bind-Value="loanApp.LoanYears" Min="1" Max="30" Step="1" Label="📅 Lånetid (år)" />

        <!-- Lånesyfte -->
        <MudSelect T="string" Label="Vad är lånesyftet?" @bind-Value="loanApp.LoanPurpose">
            <MudSelectItem Value="@("Samla lån")">Samla lån</MudSelectItem>
            <MudSelectItem Value="@("Nytt lån")">Nytt lån</MudSelectItem>
            <MudSelectItem Value="@("Renovering")">Renovering</MudSelectItem>
            <MudSelectItem Value="@("Fordon")">Fordon</MudSelectItem>
            <MudSelectItem Value="@("Hälsa")">Hälsa</MudSelectItem>
            <MudSelectItem Value="@("Övrigt")">Övrigt</MudSelectItem>
        </MudSelect>



        <!-- Civilstånd -->
        <MudSelect @bind-Value="loanApp.MaritalStatus" Label="❤️ Civilstånd" Required="true">
            <MudSelectItem Value="@("Gift")">Gift</MudSelectItem>
            <MudSelectItem Value="@("Sambo")">Sambo</MudSelectItem>
            <MudSelectItem Value="@("Singel / Ogift")">Singel/Ogift</MudSelectItem>
            <MudSelectItem Value="@("Skild")">Skild</MudSelectItem>
        </MudSelect>

        <!-- Barn -->
        <MudNumericField @bind-Value="loanApp.ChildrenUnder21" Label="👶 Antal barn under 21 år" Variant="Variant.Outlined" />

        <!-- Boendeform -->
        <MudSelect T="string" @bind-Value="loanApp.HousingType" Label="🏠 Boendeform" Required="true">
            <MudSelectItem Value="@("Villa / Radhus")">Villa/Radhus</MudSelectItem>
            <MudSelectItem Value="@("Bostadsrätt")">Bostadsrätt</MudSelectItem>
            <MudSelectItem Value="@("Hyresrätt")">Hyresrätt</MudSelectItem>
            <MudSelectItem Value="@("Inneboende")">Inneboende</MudSelectItem>
        </MudSelect>


        <!-- Månadslön -->
        <MudNumericField @bind-Value="loanApp.MonthlyIncome" Label="💼 Månadslön (kr)" Variant="Variant.Outlined" />

        <!-- Skicka -->
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4" ButtonType="ButtonType.Submit">
            📨 Skicka ansökan
        </MudButton>
    </EditForm>

    @if (submitted)
    {
        <MudPaper Class="pa-4 mt-4" Style="background-color:#e6f7ff;">
            <MudText Typo="Typo.h6">✅ Tack @loanApp.ApplicantName!</MudText>
            <MudText>Din ansökan är mottagen. Vi återkommer snart med besked.</MudText>
        </MudPaper>
    }
</MudPaper>

@code {
    private LoanApplication loanApp = new LoanApplication();
    private bool submitted = false;

    private void HandleSubmit()
    {
        submitted = true;
        loanApp.Status = "Pending";
        // Här kan du spara till databasen via DbContext
    }
}
